<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Timezone Converter</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
  <style>
    .delete-btn {
      cursor: pointer;
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body class="container py-4">
  <h2 class="mb-4">üåç Timezone Converter</h2>

  <!-- From / To Pickers -->
  <div class="row">
    <div class="col-md-6 mb-3">
      <label for="from_timezone" class="form-label">From Timezone:</label>
      <select id="from_timezone" class="form-select"></select>
    </div>
    <div class="col-md-6 mb-3">
      <label for="to_timezone" class="form-label">To Timezone:</label>
      <select id="to_timezone" class="form-select"></select>
    </div>
  </div>

  <!-- Time Selection Mode -->
  <div class="mb-3">
    <label class="form-label">Choose Time Input:</label><br>
    <input type="radio" id="now_option" name="time_mode" value="now" checked>
    <label for="now_option">Use Current Date & Time</label><br>
    <input type="radio" id="custom_option" name="time_mode" value="custom">
    <label for="custom_option">Select Date & Time</label>
  </div>

  <!-- Custom DateTime Input -->
  <div class="mb-3" id="custom_time_container" style="display:none;">
    <label for="custom_time" class="form-label">Select Date & Time:</label>
    <input type="datetime-local" id="custom_time" class="form-control">
  </div>

  <button class="btn btn-primary" onclick="convertTime()">Convert</button>

  <!-- Results -->
  <h3 class="mt-4">Conversion History:</h3>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>From</th>
        <th>To</th>
        <th>Converted Time</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="results"></tbody>
  </table>

  <script>
    const API_URL = "https://timezone-converter-d3rn.onrender.com"; // < -- replace with your backend

    // Load timezones into dropdowns
    async function loadTimezones() {
      const res = await fetch(API_URL + "/timezones");
      const data = await res.json();
      const fromSelect = document.getElementById("from_timezone");
      const toSelect = document.getElementById("to_timezone");

      data.timezones.forEach(tz => {
        const opt1 = document.createElement("option");
        opt1.value = tz; opt1.textContent = tz;
        fromSelect.appendChild(opt1);

        const opt2 = document.createElement("option");
        opt2.value = tz; opt2.textContent = tz;
        toSelect.appendChild(opt2);
      });

      new Choices(fromSelect, { searchEnabled: true, itemSelectText: "" });
      new Choices(toSelect, { searchEnabled: true, itemSelectText: "" });
    }

    // Show/hide custom datetime input
    document.getElementById("custom_option").addEventListener("change", () => {
      document.getElementById("custom_time_container").style.display = "block";
    });
    document.getElementById("now_option").addEventListener("change", () => {
      document.getElementById("custom_time_container").style.display = "none";
    });

    // Convert between timezones
    async function convertTime() {
      const from_timezone = document.getElementById("from_timezone").value;
      const to_timezone = document.getElementById("to_timezone").value;
      const mode = document.querySelector('input[name="time_mode"]:checked').value;

      let timeInput;
      if (mode === "now") {
        const now = new Date();
        const yyyy = now.getFullYear();
        const mm = String(now.getMonth() + 1).padStart(2, "0");
        const dd = String(now.getDate()).padStart(2, "0");
        const hh = String(now.getHours()).padStart(2, "0");
        const mi = String(now.getMinutes()).padStart(2, "0");
        timeInput = `${yyyy}-${mm}-${dd} ${hh}:${mi}`;
      } else {
        const customTime = document.getElementById("custom_time").value;
        if (!customTime) {
          alert("Please select a custom date & time.");
        return;
  }
  // datetime-local gives "YYYY-MM-DDTHH:MM"
  timeInput = customTime.replace("T", " ");
}

      if (!from_timezone || !to_timezone) {
        alert("Please select both timezones.");
        return;
      }

      const res = await fetch(API_URL + "/convert", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ from_timezone, time: timeInput, to_timezone })
      });

      const data = await res.json();
      const results = data.converted_times || {};
      const convertedTime = results[to_timezone];

      // Append row to history
      const tbody = document.getElementById("results");
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>${from_timezone} (${timeInput})</td>
        <td>${to_timezone}</td>
        <td>${convertedTime}</td>
        <td><span class="delete-btn" onclick="this.closest('tr').remove()">Delete</span></td>
      `;

      tbody.appendChild(row);
    }

    loadTimezones();
  </script>
</body>
</html>


